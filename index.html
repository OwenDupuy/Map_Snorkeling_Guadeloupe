<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Les Spots de Snorkeling en Guadeloupe</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* Taille de la carte */
    #map {
      height: 100vh;
      width: 100%;
    }

    /* --- L√©gende (agrandie + fond blanc) --- */
    .legend {
      background: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.4em;
      line-height: 1.6em;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .legend b {
      font-size: 1.2em;
    }

    .legend i {
      width: 20px !important;
      height: 20px !important;
      border-radius: 50%;
      margin-right: 10px;
      display: inline-block;
    }

    /* --- Marqueurs personnalis√©s color√©s --- */
    .custom-marker {
      border-radius: 50%;
      border: 2px solid #ffffff;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }

    .rating-5 { background: #1a9850; }
    .rating-4 { background: #66bd63; }
    .rating-3 { background: #c8ffb5; }
    .rating-2 { background: #fee08b; }
    .rating-1 { background: #d73027; }

    .slider {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 5px;
    }

    .slider-btn {
      border: none;
      background: rgba(0,0,0,0.6);
      color: white;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slider-btn:hover {
      background: rgba(0,0,0,0.8);
    }

    .slider-counter {
      text-align: center;
      font-size: 0.9em;
      margin-top: 2px;
      color: #333;
    }

    .slider-img-wrapper {
      width: 180px;        /* largeur fixe de la zone image */
      height: 130px;       /* hauteur fixe => le texte ne bouge plus */
      overflow: hidden;    /* on coupe ce qui d√©passe */
      border-radius: 8px;
      display: flex;
      align-items: center; /* centre l‚Äôimage verticalement */
      justify-content: center; /* centre horizontalement */
    }

    .slider-img-wrapper img {
      max-width: 100%;
      max-height: 100%;
      display: block;
    }

    #filters-box {
      position: absolute;
      left: 20px;
      top: 225px;              /* ‚âà sous la barre de recherche */
      background: white;
      padding: 10px 12px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      font-size: 1.1em;
      z-index: 999;           /* au-dessus de la carte et des tuiles */
    }

    /* Bouton d‚Äôen-t√™te (ligne "Filtres ‚ñæ") */
    .filters-header {
      width: 100%;
      background: transparent;
      border: none;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
    }

    /* Fl√®che anim√©e */
    .filters-arrow {
      display: inline-block;
      transition: transform 0.2s ease;
    }

    .filters-arrow.open {
      transform: rotate(180deg); /* fl√®che vers le haut */
    }

    /* Contenu (les cases √† cocher) */
    #filters-content {
      margin-top: 8px;
    }

    #filters-content.hidden {
      display: none;
    }

    #filters-content label {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
      font-size: 0.95em;
    }

    #filters-content input {
      margin: 0;
    }

    #filters-box h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 1.1em;
    }
    #filters-box label {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }

    .lightbox.hidden {
      display: none;
    }

    .lightbox-inner {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #lightbox-img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.6);
    }

    .lightbox-close {
      position: absolute;
      top: -40px;
      right: 0;
      border: none;
      background: transparent;
      color: white;
      font-size: 26px;
      cursor: pointer;
    }

    .lightbox-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      border: none;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 32px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .lightbox-arrow.left {
      left: -50px;
    }

    .lightbox-arrow.right {
      right: -50px;
    }

    @media (max-width: 768px) {

      /* Lightbox plus adapt√©e au t√©l√©phone */
      .lightbox-inner {
        max-width: 100vw;
        max-height: 80vh;
        padding: 0 10px;
      }

      #lightbox-img {
        max-width: 100%;
        max-height: 80vh;
      }

      .lightbox-arrow.left {
        left: 10px;
      }

      .lightbox-arrow.right {
        right: 10px;
      }

      .lightbox-close {
        top: 10px;
        right: 10px;
      }

      /* Slider images plus grand sur mobile */
      .slider-img-wrapper {
        width: 70vw;
        height: 40vw;
      }

      .slider-btn {
        width: 32px;
        height: 32px;
        font-size: 18px;
      }

      /* Filtres en bas au centre */
      #filters-box {
        left: 50%;
        right: auto;
        top: auto;
        bottom: 20px;
        transform: translateX(-50%);
        font-size: 1em;
        padding: 8px 10px;
      }
    }


  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@4.0.0/dist/leaflet-search.min.css">

</head>
  
<body>

  <div id="filters-box">
    <button id="filters-toggle" class="filters-header">
      <span>Filtres</span>
      <span class="filters-arrow">‚ñæ</span>
    </button>

    <div id="filters-content" class="hidden">
      <label><input type="checkbox" data-rating="5" checked> 5 ‚òÖ Excellent</label>
      <label><input type="checkbox" data-rating="4" checked> 4 ‚òÖ Tr√®s bien</label>
      <label><input type="checkbox" data-rating="3" checked> 3 ‚òÖ Bien</label>
      <label><input type="checkbox" data-rating="2" checked> 2 ‚òÖ Neutre</label>
      <label><input type="checkbox" data-rating="1" checked> 1 ‚òÖ Mauvais</label>

      <hr style="margin:8px 0;">

      <label><input type="checkbox" data-species="tortue"> Tortues üê¢</label>
      <label><input type="checkbox" data-species="requin"> Requins ü¶à</label>
    </div>

  </div>
  <div id="map"></div>

  <div id="lightbox" class="lightbox hidden">
    <div class="lightbox-inner">
      <button class="lightbox-close" onclick="closeLightbox()">‚úï</button>

      <button class="lightbox-arrow left" onclick="changeLightboxImage(-1)">‚Äπ</button>

      <img id="lightbox-img" src="" alt="Photo spot">

      <button class="lightbox-arrow right" onclick="changeLightboxImage(1)">‚Ä∫</button>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-search@4.0.0/dist/leaflet-search.min.js"></script>

  <script>
    /* ----------------------------------------------------------
       1. D√©finir les limites autour de la Guadeloupe
    ----------------------------------------------------------- */
    const guadeloupeBounds = L.latLngBounds(
      [15.7, -62.1],   // sud-ouest
      [16.6, -60.9]    // nord-est
    );

    /* ----------------------------------------------------------
       2. Cr√©ation de la carte + blocages de d√©placement
    ----------------------------------------------------------- */
    const map = L.map('map', {
      center: [16.265, -61.551],
      zoom: 10,
      maxBounds: guadeloupeBounds,
      maxBoundsViscosity: 1.0
    });

    // üëâ Nouveau : layer qui contiendra tous les markers
    const markersLayer = L.layerGroup().addTo(map);


    /* ----------------------------------------------------------
       3. Tuiles (fonds de carte)
    ----------------------------------------------------------- */
    const satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, USDA, USGS, GeoEye, etc.' }
    );
    
    const osm = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: '¬© OpenStreetMap contributors' }
    );

    const relief = L.tileLayer(
      'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
      { attribution: '¬© OpenTopoMap (CC-BY-SA)' }
    );

    // Couche par d√©faut
    satellite.addTo(map);

    /* ----------------------------------------------------------
       4. Contr√¥le permettant de changer de fond de carte
    ----------------------------------------------------------- */
    const baseLayers = {
      "Satellite": satellite,
      "Classique (OSM)": osm,
      "Relief": relief
    };

    L.control.layers(baseLayers, null, {
      position: 'topleft',
      collapsed: false
    }).addTo(map);

    /* ----------------------------------------------------------
       5. Fonctions utilitaires pour couleurs + √©toiles
    ----------------------------------------------------------- */
    function getColor(rating) {
      switch (rating) {
        case 5: return "#1a9850";
        case 4: return "#66bd63";
        case 3: return "#c8ffb5";
        case 2: return "#fee08b";
        case 1: return "#d73027";
        default: return "#888";
      }
    }

    function getStars(rating) {
      return "‚òÖ".repeat(rating) + "‚òÜ".repeat(5 - rating);
    }

    /* ----------------------------------------------------------
       6. Spots (√† adapter avec tes vrais lieux + photos)
    ----------------------------------------------------------- */
    const spots = [
      {
        name: "Malendure plage, Bouillante",
        coords: [16.1726, -61.7791],       // plage de Malendure :contentReference[oaicite:0]{index=0}
        desc: "Un lieu incontournable pour observer des tortues marines. Pour maximiser vos chances, rejoignez la petite plage situ√©e au nord de la plage principale de Malendure : c‚Äôest l√† que les rencontres sont les plus fr√©quentes. On y croise aussi r√©guli√®rement des poissons-torpilles et quelques barracudas. La visibilit√© y est g√©n√©ralement tr√®s bonne, ce qui en fait un spot parfait pour une exploration tranquille.",
        rating: 4,
        species: ["tortue"],
        images: ["images/malendure1.JPG","images/malendure2.JPG","images/malendure3.JPG","images/malendure4.jpg","images/malendure5.jpg","images/malendure6.jpg","images/malendure7.jpg","images/malendure8.jpg"]
      },
      {
        name: "Bosco, Deshaies",
        coords: [16.2864, -61.8027],    // plage Bosco / Paul Thomas :contentReference[oaicite:1]{index=1}
        desc: "Spot discret et paisible ‚Äì Notre coup de c≈ìur : Un lieu calme, presque secret, auquel on acc√®de en contournant un portail signal√© comme priv√© (l‚Äôacc√®s est parfaitement l√©gal). C‚Äôest l‚Äôun de nos spots pr√©f√©r√©s : la plage est bord√©e d‚Äôune grande richesse aquatique, avec une excellente visibilit√© et, parfois, la chance de croiser des tortues vertes ou imbriqu√©es. De nombreux crabes touloulous pourrons vous guidez jusqu‚Äôa la mer. La plage dispose d‚Äôun petit carbet id√©al pour installer un hamac et se d√©tendre entre deux sessions de snorkeling. On y trouve aussi quantit√© de coquillages, parfaits pour les curieux. Une ambiance tranquille et authentique, √† ne pas manquer.",
        rating: 5,
        species: ["tortue"],
        images: ["images/bosco1.jpg","images/bosco2.jpg","images/bosco3.jpg","images/bosco4.jpg","images/bosco5.jpg","images/bosco6.jpg","images/bosco7.jpg","images/bosco8.jpg","images/bosco9.jpg"]
      },
      {
        name: "Anse de Deshaies, Deshaies",
        coords: [16.3075, -61.7966],      // zone Deshaies littoral :contentReference[oaicite:2]{index=2}
        desc: "M√™me si la zone accueille de nombreux bateaux et que l‚Äôeau peut parfois √™tre un peu turbide, le spot r√©serve de belles rencontres : poissons-globes, tortues et une faune vari√©e √©voluent dans ce secteur prot√©g√© des vagues. L‚Äôambiance reste globalement calme et c‚Äôest un endroit plaisant pour une sortie snorkeling sans trop de courant. Petit bonus : l‚Äôexcellent restaurant L‚ÄôAmer se trouve juste √† c√¥t√©, parfait pour prolonger la journ√©e (l‚ÄôAssiette cr√©ole est un d√©lice).",
        rating: 2,
        species: ["tortue"],
        images: []
      },
      {
        name: "Ravine Thomas, Bouillante",
        coords: [16.1095, -61.7747],      // commune Bouillante :contentReference[oaicite:3]{index=3}
        desc: "Un spot magnifique o√π la vie foisonne : nudibranches, serpentines, poulpes, coquillages‚Ä¶ Les roches nombreuses cr√©ent une multitude de petits abris qui attirent une grande diversit√© d‚Äôesp√®ces et offrent un d√©cor riche en couleurs tout au long de l‚Äôexploration. La zone abrite une biodiversit√© de r√™ve pour les amateurs de macro et d‚Äôobservations d√©taill√©es. En bonus, le site se trouve √† proximit√© de bassins d‚Äôeaux thermales, parfaits pour une pause d√©tente apr√®s la sortie.",
        rating: 4,
        species: ["tortue"],
        images: ["images/ravine_thomas1.jpg","images/ravine_thomas2.jpg","images/ravine_thomas3.jpg","images/ravine_thomas4.jpg","images/ravine_thomas5.jpg","images/ravine_thomas6.JPG","images/ravine_thomas7.jpg","images/ravine_thomas8.jpg","images/ravine_thomas9.jpg","images/ravine_thomas10.jpg"]
      },
      {
        name: "Anse √† la Barque, Bouillante",
        coords: [16.0893, -61.7688],      // estimation proche Bouillante
        desc: "Un lieu bien prot√©g√© des vagues, g√©n√©ralement tr√®s calme et peu fr√©quent√© par les bateaux. La zone abrite une belle diversit√© d‚Äôesp√®ces, avec notamment plusieurs pieuvres, et de nombreux juv√©niles qui trouvent refuge dans les roches. Le fond est constitu√© de structures rocheuses am√©nag√©es par l‚Äôhumain, cr√©ant une multitude de petits abris pour la faune. En longeant l‚Äôanse, on passe d‚Äôune petite mangrove √† de hautes falaises, offrant un d√©cor vari√© et agr√©able √† explorer.",
        rating: 3,
        species: ["tortue"],
        images: ["images/anse_a_la_barque1.JPG","images/anse_a_la_barque2.jpg","images/anse_a_la_barque3.jpg","images/anse_a_la_barque4.jpg","images/anse_a_la_barque5.jpg","images/anse_a_la_barque6.jpg"]
      },
      {
        name: "Petite Terre, Terre-de-Bas",
        coords: [16.1747, -61.1092],      // estimation Petite-Terre
        desc: "Un incontournable absolu. V√©ritable nurserie de requins-citrons et de tortues, Petite Terre est l‚Äôun des plus beaux sites de snorkeling de Guadeloupe. On y observe r√©guli√®rement des requins-citrons juv√©niles, des raies pastenagues, et parfois, avec un peu de chance, des requins dormeurs ou des raies aigles. Les barracudas sont aussi fr√©quents dans les zones calmes. Il s‚Äôagit d‚Äôune r√©serve naturelle, avec de nombreuses r√®gles √† respecter pour prot√©ger l‚Äô√©cosyst√®me. √Ä terre, la pr√©sence d‚Äôiguanes end√©miques. Sous l‚Äôeau, de nombreux coraux sont malheureusement ab√Æm√©s dans les zones tr√®s fr√©quent√©es. La zone ouverte au public se situe uniquement entre les deux √Æles ; le reste de la r√©serve est strictement interdit d‚Äôacc√®s afin de pr√©server la faune. Un site exceptionnel, √† visiter au moins une fois.",
        rating: 5,
        species: ["tortue", "requin"],
        images: ["images/petite_terre1.jpg","images/petite_terre2.jpg","images/petite_terre3.jpg","images/petite_terre4.jpg","images/petite_terre5.jpg","images/petite_terre6.jpg","images/petite_terre7.jpg","images/petite_terre8.jpg","images/petite_terre9.jpg"]
      },
      {
        name: "Trou Man Louis, Anse-Bertrand",
        coords: [16.4861, -61.4972],      // estimation Port-Louis c√¥te Est
        desc: "Un lieu splendide, avec une eau chaude, limpide et remplie de poissons color√©s. Cependant, la prudence est de mise : lorsque la houle se l√®ve, le snorkeling peut devenir difficile et l‚Äôeau plus agit√©e. Par mer calme, c‚Äôest un v√©ritable petit paradis pour une exploration sereine.",
        rating: 3,
        species: [],
        images: ["images/trou_man_louis1.JPG","images/trou_man_louis2.jpg"]
      },
      {
        name: "√élets du Gosier, Le Gosier",
        coords: [16.2000, -61.4921],      // estimation Le Gosier
        desc: "La zone pr√©sente un fort impact anthropique, et l‚Äô√©tat du site sous-marin est malheureusement tr√®s alt√©r√©. La balade autour de l‚Äô√Ælet reste agr√©able, mais ce n‚Äôest pas un endroit recommand√© pour le snorkeling, la biodiversit√© y √©tant tr√®s pauvre.",
        rating: 1,
        species: [],
        images: []
      },
      {
        name: "Malendure pointe, Bouillante",
        coords: [16.1691, -61.7776],       // identique √† Malendure plage
        desc: "Juste au pied du club de plong√©e Les Heures Saines se trouve le v√©ritable dortoir des tortues vertes et imbriqu√©es locales. Le spot est particuli√®rement impressionnant de nuit, lorsque les tortues viennent se reposer entre les blocs rocheux. La zone offre √©galement une grande richesse de coraux et d‚Äôesp√®ces qui se cachent dans les formations rocheuses. Un lieu √† forte valeur naturelle, id√©al pour une sortie calme et immersive.",
        rating: 4,
        species: ["tortue"],
        images: ["images/malendure_night1.jpg","images/malendure_night2.jpg","images/malendure_night3.jpg","images/malendure_night4.jpg","images/malendure_night5.jpg","images/malendure_night6.JPG","images/malendure_night7.jpg","images/malendure_night8.jpg","images/malendure_night9.jpg","images/malendure_night10.jpg","images/malendure_night11.jpg","images/malendure_night12.jpg","images/malendure_night13.jpg"]
      },
      {
        name: "√élets Pigeon (R√©serve Cousteau), Bouillante",
        coords: [16.1674, -61.7895],      // coord. R√©serve Cousteau :contentReference[oaicite:4]{index=4}
        desc: "Un spot accessible en kayak, avec une eau transparente et une vaste zone √† explorer. On y rencontre de nombreux poissons balistes non agressifs, ainsi qu‚Äôune faune vari√©e dispers√©e sur une grande superficie. Le site poss√®de encore un fort potentiel d‚Äôexploration, id√©al pour ceux qui aiment s‚Äôaventurer un peu plus loin.",
        rating: 5,
        species: ["tortue"],
        images: ["images/reserve_cousteau1.jpg","images/reserve_cousteau2.JPG","images/reserve_cousteau3.jpg"]
      },
      {
        name: "Plage de Leroux, Deshaies",
        coords: [16.2769, -61.8050],      // proche plage Bosco / Leroux :contentReference[oaicite:5]{index=5}
        desc: "L‚Äôun des meilleurs endroits pour profiter d‚Äôun excellent √©quilibre entre calme, beaut√© et qualit√© de snorkeling. L‚Äô√©pi central concentre une biodiversit√© remarquable, m√™me si la zone reste relativement petite. Le reste du site est un peu plus d√©grad√©, mais l‚Äôensemble demeure tr√®s agr√©able : passer une apr√®s-midi sur cette plage est vivement recommand√©.",
        rating: 3,
        species: ["tortue"],
        images: ["images/plage_leroux1.jppg.JPG","images/plage_leroux2.jpg","images/plage_leroux3.jpg","images/plage_leroux4.jpg","images/plage_leroux5.jpg","images/plage_leroux6.jpg","images/plage_leroux7.JPG"]
      },
      {
        name: "Plage du Souffleur, Port-Louis",
        coords: [16.4258, -61.5353],      // estimation Port-Louis
        desc: "Le fond marin est assez d√©grad√©, avec des r√©sidus de filets de p√™che et quelques plastiques dispers√©s sur le sable. L‚Äôeau reste belle et l‚Äôon peut croiser quelques poissons, mais le snorkeling est moins int√©ressant que sur d‚Äôautres sites de l‚Äô√Æle. La plage, en revanche, est tr√®s fr√©quent√©e et particuli√®rement jolie, id√©ale pour profiter d‚Äôun moment au soleil en famille ou entre amis, m√™me si l‚Äôexploration sous-marine est limit√©e.",
        rating: 2,
        species: [],
        images: ["images/plage_du_souffleur1.jpg","images/plage_du_souffleur2.jpg"]
      },
      {
        name: "Plage d‚ÄôAntigues, Port-Louis",
        coords: [16.4369, -61.5386],      // estimation c√¥te Est
        desc: "Une plage similaire √† la tr√®s connue plage du Souffleur, mais plus √©loign√©e du centre, donc nettement plus calme et moins fr√©quent√©e. Les herbiers marins y sont plus pr√©sents, offrant de belles occasions d‚Äôobserver des raies et parfois m√™me des requins-citrons juv√©niles. Un spot agr√©able pour ceux qui veulent profiter de la nature sans la foule.",
        rating: 3,
        species: ["requin"],
        images: ["images/plage_antigues1.jpg","images/plage_antigues2.jpg","images/plage_antigues3.jpg","images/plage_antigues4.jpg"]
      },
      {
        name: "Anse des Rochers, Saint-Fran√ßois",
        coords: [16.2417, -61.3064],      // estimation St-Fran√ßois c√¥t√© Est
        desc: "Plage s√©curis√©e et id√©ale pour les d√©butants Un site accessible via une r√©sidence / centre de vacances, avec une tr√®s belle plage prot√©g√©e des vagues et parfaitement adapt√©e au snorkeling calme. La zone abrite surtout des esp√®ces juv√©niles, qui trouvent refuge dans les herbiers et les petits amas de roches dispers√©s pr√®s du rivage. Un spot agr√©able pour une sortie tranquille et s√©curis√©e.",
        rating: 2,
        species: [],
        images: []
      },
      {
        name: "Les Trois Pointes, Vieux-Fort",
        coords: [15.9556, -61.7105],      // estimation Vieux-Fort sud Basse-Terre
        desc: "Un lieu riche en couleurs et en biodiversit√©, o√π les nuances de bleu sont absolument magnifiques et o√π de nombreuses esp√®ces √©voluent autour de vous. Il peut y avoir un peu de mouvement d‚Äôeau, donc prudence, mais l‚Äôendroit reste un spot recul√©, paisible et parfait pour une exploration en immersion totale.",
        rating: 4,
        species: ["tortue"],
        images: ["images/les_trois_pointes1.JPG","images/les_trois_pointes2.jpg","images/les_trois_pointes3.jpg"]
      },
      {
        name: "Morphy, Pointe-Noire",
        coords: [16.2527, -61.8043],      
        desc: "Un lieu l√©g√®rement expos√© √† la houle de la mer des Cara√Øbes, mais qui reste un excellent spot de plong√©e comme de snorkeling. Les reliefs sous-marins y sont particuli√®rement vari√©s, avec une belle diversit√© de couleurs, d‚Äôesp√®ces et de structures rocheuses. La plage est constitu√©e de galets et la pente descend doucement jusqu‚Äô√† environ 30 m√®tres de profondeur, offrant un d√©cor grandiose m√™me depuis la surface. C‚Äôest tout simplement l‚Äôun des sites les plus beaux et les plus color√©s de la r√©gion, un incontournable pour les amateurs de fonds marins vibrants.",
        rating: 4,
        species: ["tortue"],
        images: ["images/morphy1.JPG","images/morphy2.JPG","images/morphy3.JPG","images/morphy4.JPG","images/morphy5.JPG","images/morphy6.JPG"]
      },
      {
        name: "Plage de la R√©sidence D√©partementale, Le Gosier",
        coords: [16.2147, -61.5160],      
        desc: "Petite plage situ√©e au pied du fort. L‚Äôendroit est charmant et un peu escarp√©, mais la visibilit√© est tr√®s mauvaise : les vagues remuent constamment le sable, ce qui emp√™che toute observation sous-marine.",
        rating: 1,
        species: [],
        images: []
      },
      {
        name: "Plage de Bas-Du-Fort, Le Gosier",
        coords: [16.2138, -61.5240],      
        desc: "Jolie plage touristique mais snorkeling limit√©. Une tr√®s belle plage, petite et souvent fr√©quent√©e par les visiteurs. L‚Äôeau y est bien prot√©g√©e, mais la visibilit√© reste faible et la biodiversit√© observ√©e est assez limit√©e. Un endroit agr√©able pour se baigner et profiter du cadre, mais pas vraiment adapt√© au snorkeling.",
        rating: 1,
        species: [],
        images: []
      },
      {
        name: "Plage de Petit-Havre, Sainte-Anne",
        coords: [16.2090, -61.4270],      
        desc: "Petit coin sauvage et convivial. Un lieu appr√©ci√© pour son c√¥t√© sauvage, les barbecues en bord de mer et un peu de surf selon les conditions. Quelques zones plus recul√©es offrent une visibilit√© correcte et permettent d‚Äôobserver quelques poissons, mais cela reste un petit spot de snorkeling, avec une richesse sous-marine limit√©e. Un endroit agr√©able pour profiter de l‚Äôambiance, plus que pour une exploration approfondie.",
        rating: 2,
        species: [],
        images: []
      },
      {
        name: "Anse Sainte-Marguerite, Le Moule",
        coords: [16.3893, -61.4049],      
        desc: "Zone partiellement prot√©g√©e des vagues, mais qui devient vite impraticable voire dangereuse lorsque la houle est forte (ce qui est fr√©quent sur cette c√¥te). Plage assez rocheuse, relativement pollu√©e et peu adapt√©e au snorkeling. C‚Äôest surtout un tr√®s bel endroit pour se promener plut√¥t que pour observer les fonds marins.",
        rating: 1,
        species: [],
        images: []
      },
      {
        name: "Anse √† sable, Bouillante",
        coords: [16.1453, -61.7789],      
        desc: "",
        rating: 3,
        species: [],
        images: []
      },
      {
        name: "Pointe de l'Ermitage, Bouillante",
        coords: [16.1260, -61.7752],      
        desc: "",
        rating: 2,
        species: [],
        images: []
      }
    ];

    /* ----------------------------------------------------------
       7. Marqueurs color√©s + popup avec photo
    ----------------------------------------------------------- */

    // Index courant de l'image pour chaque spot
    const currentImageIndex = spots.map(() => 0);

    const sliderIntervals = {}; // pour m√©moriser les setInterval par spot
    let lightboxSpotIndex = null;
    
    // Fonction appel√©e par les boutons ‚Äπ et ‚Ä∫ dans la popup
    function changeImage(spotIndex, direction) {
      const imgs = spots[spotIndex].images;
      if (!imgs || imgs.length === 0) return;

      const n = imgs.length;
      currentImageIndex[spotIndex] =
        (currentImageIndex[spotIndex] + direction + n) % n;

      const imgEl = document.getElementById(`slider-img-${spotIndex}`);
      const counterEl = document.getElementById(`slider-counter-${spotIndex}`);

      if (imgEl) {
        imgEl.src = imgs[currentImageIndex[spotIndex]];
      }
      if (counterEl) {
        counterEl.textContent = `${currentImageIndex[spotIndex] + 1} / ${n}`;
      }

      // si la lightbox est ouverte sur ce spot, on met aussi √† jour la grande image
      if (lightboxSpotIndex === spotIndex) {
        const bigImg = document.getElementById('lightbox-img');
        if (bigImg) {
          bigImg.src = imgs[currentImageIndex[spotIndex]];
        }
      }
    }

    function openLightbox(spotIndex) {
      const imgs = spots[spotIndex].images;
      if (!imgs || imgs.length === 0) return;

      lightboxSpotIndex = spotIndex;

      const bigImg = document.getElementById('lightbox-img');
      bigImg.src = imgs[currentImageIndex[spotIndex]];

      document.getElementById('lightbox').classList.remove('hidden');
    }

    function closeLightbox() {
      document.getElementById('lightbox').classList.add('hidden');
      lightboxSpotIndex = null;
    }

    function changeLightboxImage(direction) {
      if (lightboxSpotIndex === null) return;
      changeImage(lightboxSpotIndex, direction);  // r√©utilise la logique existante
    }

    spots.forEach((spot, index) => {

      let imagesHtml = "";
      if (spot.images && spot.images.length > 0) {
      imagesHtml = `
        <div class="slider">
          <button type="button"
                  class="slider-btn"
                  onclick="changeImage(${index}, -1)">‚Äπ</button>
          <div class="slider-img-wrapper"
               onclick="openLightbox(${index})">
            <img id="slider-img-${index}"
                  src="${spot.images[0]}"
                  alt="${spot.name}">
          </div>
          <button type="button"
                  class="slider-btn"
                  onclick="changeImage(${index}, 1)">‚Ä∫</button>
        </div>
        <div class="slider-counter"
              id="slider-counter-${index}">
              1 / ${spot.images.length}
        </div>
      `;
    }

      const popupContent = `
        <b>${spot.name}</b><br>
        ${spot.desc}<br>
        Note : ${getStars(spot.rating)}<br><br>
        ${imagesHtml}
      `;

      const icon = L.divIcon({
        className: `custom-marker rating-${spot.rating}`,
        iconSize: [24, 24],
        iconAnchor: [12, 12]
      });

      // üëâ on cr√©e le marker, avec un "title" = nom du spot (utilis√© par le plugin de recherche)
      const marker = L.marker(spot.coords, {
        icon,
        title: spot.name
      }).bindPopup(popupContent);

      // üëâ on garde les infos sur le marker pour les filtres plus tard
      marker.rating = spot.rating;  // note associ√©e au marker
      spot._marker = marker;        // on stocke le marker dans l'objet spot
      marker.spotIndex = index;

      // üëâ on l‚Äôajoute au layer de markers (et donc √† la carte)
      markersLayer.addLayer(marker);
    });
    /* ----------------------------------------------------------
       8. L√©gende √©toiles + couleurs
    ----------------------------------------------------------- */
    const legend = L.control({ position: 'topright' });

    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      const ratings = [5, 4, 3, 2, 1];

      div.innerHTML += "<b>Qualit√© du spot</b><br>";

      ratings.forEach(r => {
        div.innerHTML += `
          <i style="background:${getColor(r)};"></i>
          ${getStars(r)}<br>
        `;
      });

      return div;
    };

    legend.addTo(map);

    // ----------------------------------------------------------
    // 9. Contr√¥le de recherche des spots
    // ----------------------------------------------------------
    const searchControl = new L.Control.Search({
      layer: markersLayer,              // on cherche dans ce layer
      propertyName: 'title',            // ce qu‚Äôon cherche = option "title" du marker
      marker: false,                    // ne pas ajouter un marker rouge par d√©faut
      initial: false,
      zoom: 14,
      textPlaceholder: 'Rechercher un spot...',
      collapsed: false                  // si tu veux qu‚Äôil soit ouvert par d√©faut
    });

    // Quand un spot est trouv√©, on ouvre sa popup
    searchControl.on('search:locationfound', function (e) {
      if (e.layer._popup) {
        e.layer.openPopup();
      }
    });

    map.addControl(searchControl);

    // --- Auto-d√©filement des images dans la popup ---
    map.on('popupopen', function (e) {
      const marker = e.popup._source;
      const i = marker.spotIndex;

      const imgs = spots[i].images;
      if (!imgs || imgs.length <= 1) return; // pas de slider si 0 ou 1 image

      // on nettoie un √©ventuel ancien intervalle
      if (sliderIntervals[i]) {
        clearInterval(sliderIntervals[i]);
      }

      // toutes les 3 secondes, on passe √† l'image suivante
      sliderIntervals[i] = setInterval(() => {
        changeImage(i, 1);
      }, 10000);
    });

    map.on('popupclose', function (e) {
      const marker = e.popup._source;
      const i = marker.spotIndex;

      if (sliderIntervals[i]) {
        clearInterval(sliderIntervals[i]);
        delete sliderIntervals[i];
      }
    });


    // --- Ouverture / fermeture du bloc filtres ---
    const filtersToggle = document.getElementById('filters-toggle');
    const filtersContent = document.getElementById('filters-content');
    const filtersArrow = document.querySelector('.filters-arrow');

    filtersToggle.addEventListener('click', () => {
      filtersContent.classList.toggle('hidden');
      filtersArrow.classList.toggle('open');
    });

    
    // ----------------------------------------------------------
    // 10. FILTRE PAR NOTE
    // ----------------------------------------------------------
    const checkboxes = document.querySelectorAll('#filters-box input[type="checkbox"]');

    checkboxes.forEach(cb => {
      cb.addEventListener('change', () => {

        // --- 1. Notes autoris√©es ---
        const allowedRatings = [...checkboxes]
          .filter(c => c.checked && c.dataset.rating)
          .map(c => Number(c.dataset.rating));

        // --- 2. Esp√®ces coch√©es ---
        const allowedSpecies = [...checkboxes]
          .filter(c => c.checked && c.dataset.species)
          .map(c => c.dataset.species);

        spots.forEach(spot => {
          const m = spot._marker;

          // --- Condition rating ---
          const ratingOK = allowedRatings.includes(spot.rating);

          // --- Condition esp√®ces ---
          let speciesOK = true;

          if (allowedSpecies.length > 0) {
            // le spot doit contenir toutes les esp√®ces coch√©es
            speciesOK = allowedSpecies.every(sp => spot.species.includes(sp));
          }

          // --- Affichage ou masquage ---
          if (ratingOK && speciesOK) {
            markersLayer.addLayer(m);
          } else {
            markersLayer.removeLayer(m);
          }
        });
      });
    });

  </script>
</body>
</html>
