<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Les meilleurs spots de Snorkeling en Guadeloupe</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* Taille de la carte */
    #map {
      height: 100vh;
      width: 100%;
    }

    /* --- LÃ©gende (agrandie + fond blanc) --- */
    .legend {
      background: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.4em;
      line-height: 1.6em;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .legend b {
      font-size: 1.2em;
    }

    .legend i {
      width: 20px !important;
      height: 20px !important;
      border-radius: 50%;
      margin-right: 10px;
      display: inline-block;
    }

    /* --- Marqueurs personnalisÃ©s colorÃ©s --- */
    .custom-marker {
      border-radius: 50%;
      border: 2px solid #ffffff;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }

    .rating-5 { background: #1a9850; }
    .rating-4 { background: #66bd63; }
    .rating-3 { background: #c8ffb5; }
    .rating-2 { background: #fee08b; }
    .rating-1 { background: #d73027; }

    .slider {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 5px;
    }

    .slider-btn {
      border: none;
      background: rgba(0,0,0,0.6);
      color: white;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slider-btn:hover {
      background: rgba(0,0,0,0.8);
    }

    .slider-counter {
      text-align: center;
      font-size: 0.9em;
      margin-top: 2px;
      color: #333;
    }

  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-search@4.0.0/dist/leaflet-search.min.css">

</head>

<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/leaflet-search@4.0.0/dist/leaflet-search.min.js"></script>

  <script>
    /* ----------------------------------------------------------
       1. DÃ©finir les limites autour de la Guadeloupe
    ----------------------------------------------------------- */
    const guadeloupeBounds = L.latLngBounds(
      [15.7, -62.1],   // sud-ouest
      [16.6, -60.9]    // nord-est
    );

    /* ----------------------------------------------------------
       2. CrÃ©ation de la carte + blocages de dÃ©placement
    ----------------------------------------------------------- */
    const map = L.map('map', {
      center: [16.265, -61.551],
      zoom: 10,
      maxBounds: guadeloupeBounds,
      maxBoundsViscosity: 1.0
    });

    // ðŸ‘‰ Nouveau : layer qui contiendra tous les markers
    const markersLayer = L.layerGroup().addTo(map);


    /* ----------------------------------------------------------
       3. Tuiles (fonds de carte)
    ----------------------------------------------------------- */
    const satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Tiles Â© Esri â€” Source: Esri, USDA, USGS, GeoEye, etc.' }
    );
    
    const osm = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: 'Â© OpenStreetMap contributors' }
    );

    const relief = L.tileLayer(
      'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
      { attribution: 'Â© OpenTopoMap (CC-BY-SA)' }
    );

    // Couche par dÃ©faut
    satellite.addTo(map);

    /* ----------------------------------------------------------
       4. ContrÃ´le permettant de changer de fond de carte
    ----------------------------------------------------------- */
    const baseLayers = {
      "Satellite": satellite,
      "Classique (OSM)": osm,
      "Relief": relief
    };

    L.control.layers(baseLayers, null, {
      position: 'topleft',
      collapsed: false
    }).addTo(map);

    /* ----------------------------------------------------------
       5. Fonctions utilitaires pour couleurs + Ã©toiles
    ----------------------------------------------------------- */
    function getColor(rating) {
      switch (rating) {
        case 5: return "#1a9850";
        case 4: return "#66bd63";
        case 3: return "#c8ffb5";
        case 2: return "#fee08b";
        case 1: return "#d73027";
        default: return "#888";
      }
    }

    function getStars(rating) {
      return "â˜…".repeat(rating) + "â˜†".repeat(5 - rating);
    }

    /* ----------------------------------------------------------
       6. Spots (Ã  adapter avec tes vrais lieux + photos)
    ----------------------------------------------------------- */
    const spots = [
      {
        name: "Malendure, Bouillante",
        coords: [16.1726, -61.7791],       // plage de Malendure :contentReference[oaicite:0]{index=0}
        desc: "Lieu de rÃªve pour croiser des tortues. Il faut rejoindre la petite plage au nord de la plage principale de Malendure pour maximiser ses chances dâ€™en voir en milieu sauvage. On peut Ã©galement observer des torpilles et des barracudas. La visibilitÃ© est globalement bonne.",
        rating: 4,
        images: ["images/malendure1.JPG","images/malendure2.JPG","images/malendure3.JPG","images/malendure4.jpg","images/malendure5.jpg","images/malendure6.jpg","images/malendure7.jpg","images/malendure8.jpg"]
      },
      {
        name: "Bosco, Deshaies",
        coords: [16.2864, -61.8027],    // plage Bosco / Paul Thomas :contentReference[oaicite:1]{index=1}
        desc: "Lieu calme et un peu secret. On y accÃ¨de en contournant un portail prÃ©sentÃ© comme une rÃ©sidence privÃ©e. Beaucoup de crabes touloulous, une trÃ¨s bonne visibilitÃ© et une grande richesse aquatique de part et dâ€™autre de la plage.",
        rating: 5,
        images: ["images/bosco1.jpg","images/bosco2.jpg","images/bosco3.jpg","images/bosco4.jpg","images/bosco5.jpg","images/bosco6.jpg","images/bosco7.jpg","images/bosco8.jpg","images/bosco9.jpg"]
      },
      {
        name: "Anse de Deshaies, Deshaies",
        coords: [16.3075, -61.7966],      // zone Deshaies littoral :contentReference[oaicite:2]{index=2}
        desc: "Beaucoup de bateaux et un peu de turbiditÃ©, mais prÃ©sence de poissons-globes et de tortues. Spot protÃ©gÃ© des vagues et plutÃ´t calme. Coin agrÃ©able avec en bonus un excellent restaurant, â€œLâ€™Amerâ€, tout proche.",
        rating: 2,
        images: []
      },
      {
        name: "Ravine Thomas, Bouillante",
        coords: [16.1095, -61.7747],      // commune Bouillante :contentReference[oaicite:3]{index=3}
        desc: "BiodiversitÃ© de rÃªve entre nudibranches et serpentines. Site riche en vie et en couleurs, avec de beaux coquillages et une grande diversitÃ© dâ€™espÃ¨ces tout au long de lâ€™exploration. ProximitÃ© de bassins dâ€™eaux thermales.",
        rating: 4,
        images: ["images/ravine_thomas1.jpg","images/ravine_thomas2.jpg","images/ravine_thomas3.jpg","images/ravine_thomas4.jpg","images/ravine_thomas5.jpg","images/ravine_thomas6.JPG","images/ravine_thomas7.jpg","images/ravine_thomas8.jpg","images/ravine_thomas9.jpg","images/ravine_thomas10.jpg"]
      },
      {
        name: "Anse Ã  la Barque, Bouillante",
        coords: [16.0893, -61.7688],      // estimation proche Bouillante
        desc: "Lieu protÃ©gÃ© des vagues, calme et avec peu de bateaux. Bon nombre dâ€™espÃ¨ces, notamment plusieurs pieuvres. Environnement de roches amÃ©nagÃ©es par lâ€™humain, avec prÃ©sence de mangroves puis de falaises au bout de lâ€™anse.",
        rating: 3,
        images: ["images/anse_a_la_barque1.JPG","images/anse_a_la_barque2.jpg","images/anse_a_la_barque3.jpg","images/anse_a_la_barque4.jpg","images/anse_a_la_barque5.jpg","images/anse_a_la_barque6.jpg"]
      },
      {
        name: "Petite Terre, Terre-de-Bas",
        coords: [16.1747, -61.1092],      // estimation Petite-Terre
        desc: "VÃ©ritable nurserie de requins-citrons et de tortues. Le site est connu pour les requins-citrons juvÃ©niles, les raies pastenagues et, avec un peu de chance, les requins dormeurs et les raies aigles. Câ€™est une rÃ©serve naturelle avec beaucoup de rÃ¨gles en vigueur. Forte prÃ©sence dâ€™iguanes Ã  terre et coraux plutÃ´t abÃ®mÃ©s dans la zone frÃ©quentÃ©e. La zone accessible au public se situe entre les deux Ã®les, le reste est interdit.",
        rating: 5,
        images: ["images/petite_terre1.jpg","images/petite_terre2.jpg","images/petite_terre3.jpg","images/petite_terre4.jpg","images/petite_terre5.jpg","images/petite_terre6.jpg","images/petite_terre7.jpg","images/petite_terre8.jpg","images/petite_terre9.jpg"]
      },
      {
        name: "Trou Man Louis, Anse-Bertrand",
        coords: [16.4861, -61.4972],      // estimation Port-Louis cÃ´te Est
        desc: "Endroit paradisiaque, mais il faut faire attention : en cas de vagues, le snorkeling devient trÃ¨s difficile. Eau transparente et chaude, avec de nombreux poissons colorÃ©s Ã  observer.",
        rating: 3,
        images: ["images/trou_man_louis1.JPG","images/trou_man_louis2.jpg"]
      },
      {
        name: "ÃŽlets du Gosier, Le Gosier",
        coords: [16.2000, -61.4921],      // estimation Le Gosier
        desc: "Site trÃ¨s dÃ©gradÃ© avec un fort impact anthropique. La balade autour de lâ€™Ã®let est sympa, mais ce nâ€™est pas un spot intÃ©ressant pour le snorkeling.",
        rating: 1,
        images: []
      },
      {
        name: "Malendure, Bouillante",
        coords: [16.1691, -61.7776],       // identique Ã  Malendure plage
        desc: "Au pied du club de plongÃ©e â€œLes Heures Sainesâ€ se trouve le dortoir des tortues vertes et imbriquÃ©es locales. Sortie conseillÃ©e de nuit. Grande richesse dâ€™espÃ¨ces et de coraux entre les gros blocs rocheux.",
        rating: 4,
        images: ["images/malendure_night1.jpg","images/malendure_night2.jpg","images/malendure_night3.jpg","images/malendure_night4.jpg","images/malendure_night5.jpg","images/malendure_night6.JPG","images/malendure_night7.jpg","images/malendure_night8.jpg","images/malendure_night9.jpg","images/malendure_night10.jpg","images/malendure_night11.jpg","images/malendure_night12.jpg","images/malendure_night13.jpg"]
      },
      {
        name: "ÃŽlets Pigeon (RÃ©serve Cousteau), Bouillante",
        coords: [16.1674, -61.7895],      // coord. RÃ©serve Cousteau :contentReference[oaicite:4]{index=4}
        desc: "AccÃ¨s en kayak, eau transparente et grande zone dâ€™exploration. PrÃ©sence de nombreux poissons balistes (non agressifs). Potentiel dâ€™exploration encore important.",
        rating: 5,
        images: ["images/reserve_cousteau1.jpg","images/reserve_cousteau2.JPG","images/reserve_cousteau3.jpg"]
      },
      {
        name: "Plage de Leroux, Deshaies",
        coords: [16.2769, -61.8050],      // proche plage Bosco / Leroux :contentReference[oaicite:5]{index=5}
        desc: "Un des meilleurs endroits en termes dâ€™Ã©quilibre entre calme, beautÃ© et qualitÃ© de snorkeling. Lâ€™Ã©pi central est trÃ¨s riche en biodiversitÃ©, mÃªme si la zone reste assez petite. Le reste est un peu plus dÃ©gradÃ©, mais une aprÃ¨s-midi sur cette plage est fortement conseillÃ©e.",
        rating: 3,
        images: ["images/plage_leroux1.jppg.JPG","images/plage_leroux2.jpg","images/plage_leroux3.jpg","images/plage_leroux4.jpg","images/plage_leroux5.jpg","images/plage_leroux6.jpg","images/plage_leroux7.JPG"]
      },
      {
        name: "Plage du Souffleur, Port-Louis",
        coords: [16.4258, -61.5353],      // estimation Port-Louis
        desc: "Fond plutÃ´t dÃ©gradÃ© et polluÃ© par des rÃ©sidus de filets de pÃªche et quelques plastiques sur le sable. Lâ€™eau reste belle avec quelques poissons, mais il y a relativement peu Ã  voir comparÃ© Ã  dâ€™autres sites. Plage trÃ¨s frÃ©quentÃ©e et trÃ¨s jolie.",
        rating: 2,
        images: ["images/plage_du_souffleur1.jpg","images/plage_du_souffleur2.jpg"]
      },
      {
        name: "Plage dâ€™Antigues, Port-Louis",
        coords: [16.4369, -61.5386],      // estimation cÃ´te Est
        desc: "Semblable Ã  la trÃ¨s connue plage du Souffleur, mais plus excentrÃ©e, donc plus calme et moins frÃ©quentÃ©e. Plus de prÃ©sence dâ€™herbiers marins, avec possibilitÃ© dâ€™observer des raies et des requins juvÃ©niles.",
        rating: 3,
        images: ["images/plage_antigues1.jpg","images/plage_antigues2.jpg","images/plage_antigues3.jpg","images/plage_antigues4.jpg"]
      },
      {
        name: "Anse des Rochers, Saint-FranÃ§ois",
        coords: [16.2417, -61.3064],      // estimation St-FranÃ§ois cÃ´tÃ© Est
        desc: "Site accessible via une rÃ©sidence / centre de vacances. TrÃ¨s belle plage, sÃ©curisÃ©e et protÃ©gÃ©e des vagues. Principalement des espÃ¨ces juvÃ©niles qui se cachent dans les herbiers et les petits amas de roches.",
        rating: 2,
        images: []
      },
      {
        name: "Les Trois Pointes, Vieux-Fort",
        coords: [15.9556, -61.7105],      // estimation Vieux-Fort sud Basse-Terre
        desc: "Riche en couleurs et en biodiversitÃ©, avec des bleus marins magnifiques et de nombreuses espÃ¨ces prÃ©sentes. Attention aux possibles mouvements dâ€™eau. Lieu reculÃ©, trÃ¨s agrÃ©able Ã  explorer en immersion complÃ¨te.",
        rating: 4,
        images: ["images/les_trois_pointes1.JPG","images/les_trois_pointes2.jpg","images/les_trois_pointes3.jpg"]
      },
      {
        name: "Morphy, Pointe-Noire",
        coords: [16.2527, -61.8043],      
        desc: "Lieu lÃ©gÃ¨rement exposÃ© Ã  la houle de la mer des CaraÃ¯bes. Excellent spot de plongÃ©e et trÃ¨s bon endroit pour le snorkeling. Les reliefs sous-marins y sont nombreux, avec une belle diversitÃ© de couleurs et dâ€™espÃ¨ces. Plage de galets, pente douce qui descend rÃ©guliÃ¨rement jusquâ€™Ã  environ 30 mÃ¨tres de profondeur.",
        rating: 4,
        images: ["images/morphy1.JPG","images/morphy2.JPG","images/morphy3.JPG","images/morphy4.JPG","images/morphy5.JPG","images/morphy6.JPG"]
      },
      {
        name: "Plage de la RÃ©sidence DÃ©partementale, Le Gosier",
        coords: [16.2147, -61.5160],      
        desc: "Petite plage situÃ©e au pied du fort. Lâ€™endroit est charmant et un peu escarpÃ©, mais la visibilitÃ© est trÃ¨s mauvaise : les vagues remuent constamment le sable, ce qui empÃªche toute observation sous-marine.",
        rating: 1,
        images: []
      },
      {
        name: "Plage de Bas-Du-Fort, Le Gosier",
        coords: [16.2138, -61.5240],      
        desc: "TrÃ¨s belle plage, trÃ¨s touristique et plutÃ´t petite. Lâ€™eau y est protÃ©gÃ©e, mais la visibilitÃ© reste faible et la biodiversitÃ© observÃ©e limitÃ©e. Spot agrÃ©able pour se baigner, mais peu adaptÃ© au snorkeling.",
        rating: 1,
        images: []
      },
      {
        name: "Plage de Petit-Havre, Sainte-Anne",
        coords: [16.2090, -61.4270],      
        desc: "Petit coin sauvage apprÃ©ciÃ© pour les barbecues et un peu de surf. Quelques zones plus reculÃ©es offrent une visibilitÃ© correcte et quelques poissons, mais cela reste un petit spot de snorkeling sans grande richesse.",
        rating: 2,
        images: []
      },
      {
        name: "Anse Sainte-Marguerite, Le Moule",
        coords: [16.3893, -61.4049],      
        desc: "Zone partiellement protÃ©gÃ©e des vagues, mais qui devient vite impraticable lorsque la houle est forte (ce qui est frÃ©quent sur cette cÃ´te). Plage assez rocheuse, pas trÃ¨s propre et peu adaptÃ©e au snorkeling. Câ€™est surtout un trÃ¨s bel endroit pour se promener plutÃ´t que pour observer les fonds marins.",
        rating: 1,
        images: []
      }
    ];

    /* ----------------------------------------------------------
       7. Marqueurs colorÃ©s + popup avec photo
    ----------------------------------------------------------- */

    // Index courant de l'image pour chaque spot
    const currentImageIndex = spots.map(() => 0);

    // Fonction appelÃ©e par les boutons â€¹ et â€º
    function changeImage(spotIndex, direction) {
      const imgs = spots[spotIndex].images;
      if (!imgs || imgs.length === 0) return;

      const n = imgs.length;
      // on avance ou recule dans le tableau, en bouclant
      currentImageIndex[spotIndex] =
        (currentImageIndex[spotIndex] + direction + n) % n;

      const imgEl = document.getElementById(`slider-img-${spotIndex}`);
      const counterEl = document.getElementById(`slider-counter-${spotIndex}`);

      if (imgEl) {
        imgEl.src = imgs[currentImageIndex[spotIndex]];
      }
      if (counterEl) {
        counterEl.textContent = `${currentImageIndex[spotIndex] + 1} / ${n}`;
      }
    }

    
    spots.forEach((spot, index) => {

      let imagesHtml = "";
      if (spot.images && spot.images.length > 0) {
        imagesHtml = `
          <div class="slider">
            <button type="button"
                    class="slider-btn"
                    onclick="changeImage(${index}, -1)">â€¹</button>
            <img id="slider-img-${index}"
                  src="${spot.images[0]}"
                  alt="${spot.name}"
                  style="max-width:180px; border-radius:8px; display:block;">
            <button type="button"
                    class="slider-btn"
                    onclick="changeImage(${index}, 1)">â€º</button>
          </div>
          <div class="slider-counter"
                id="slider-counter-${index}">
                1 / ${spot.images.length}
          </div>
        `;
      }

      const popupContent = `
        <b>${spot.name}</b><br>
        ${spot.desc}<br>
        Note : ${getStars(spot.rating)}<br><br>
        ${imagesHtml}
      `;

      const icon = L.divIcon({
      className: `custom-marker rating-${spot.rating}`,
      iconSize: [24, 24],
      iconAnchor: [12, 12]
    });

      // ðŸ‘‰ on crÃ©e le marker, avec un "title" = nom du spot (utilisÃ© par le plugin de recherche)
      const marker = L.marker(spot.coords, {
        icon,
        title: spot.name
      }).bindPopup(popupContent);

      // ðŸ‘‰ on lâ€™ajoute au layer de markers (et donc Ã  la carte)
      markersLayer.addLayer(marker);
  });

    /* ----------------------------------------------------------
       8. LÃ©gende Ã©toiles + couleurs
    ----------------------------------------------------------- */
    const legend = L.control({ position: 'topright' });

    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      const ratings = [5, 4, 3, 2, 1];

      div.innerHTML += "<b>QualitÃ© du spot</b><br>";

      ratings.forEach(r => {
        div.innerHTML += `
          <i style="background:${getColor(r)};"></i>
          ${getStars(r)}<br>
        `;
      });

      return div;
    };

    legend.addTo(map);

    // ----------------------------------------------------------
    // 9. ContrÃ´le de recherche des spots
    // ----------------------------------------------------------
    const searchControl = new L.Control.Search({
      layer: markersLayer,              // on cherche dans ce layer
      propertyName: 'title',            // ce quâ€™on cherche = option "title" du marker
      marker: false,                    // ne pas ajouter un marker rouge par dÃ©faut
      initial: false,
      zoom: 14,
      textPlaceholder: 'Rechercher un spot...',
      collapsed: false                  // si tu veux quâ€™il soit ouvert par dÃ©faut
    });

    // Quand un spot est trouvÃ©, on ouvre sa popup
    searchControl.on('search:locationfound', function (e) {
      if (e.layer._popup) {
        e.layer.openPopup();
      }
    });

    map.addControl(searchControl);

  </script>
</body>
</html>
