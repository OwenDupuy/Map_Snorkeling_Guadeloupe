<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Les meilleurs spots de Snorkeling en Guadeloupe</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    /* Taille de la carte */
    #map {
      height: 100vh;
      width: 100%;
    }

    /* --- Légende (agrandie + fond blanc) --- */
    .legend {
      background: white;
      padding: 15px;
      border-radius: 10px;
      font-size: 1.4em;
      line-height: 1.6em;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .legend b {
      font-size: 1.2em;
    }

    .legend i {
      width: 20px !important;
      height: 20px !important;
      border-radius: 50%;
      margin-right: 10px;
      display: inline-block;
    }

    /* --- Marqueurs personnalisés colorés --- */
    .custom-marker {
      border-radius: 50%;
      border: 2px solid #ffffff;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }

    .rating-5 { background: #1a9850; }
    .rating-4 { background: #fee08b; }
    .rating-3 { background: #c8ffb5; }
    .rating-2 { background: #f46d43; }
    .rating-1 { background: #d73027; }

    .slider {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 5px;
    }

    .slider-btn {
      border: none;
      background: rgba(0,0,0,0.6);
      color: white;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slider-btn:hover {
      background: rgba(0,0,0,0.8);
    }

    .slider-counter {
      text-align: center;
      font-size: 0.9em;
      margin-top: 2px;
      color: #333;
    }

  </style>
</head>

<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    /* ----------------------------------------------------------
       1. Définir les limites autour de la Guadeloupe
    ----------------------------------------------------------- */
    const guadeloupeBounds = L.latLngBounds(
      [15.7, -62.1],   // sud-ouest
      [16.6, -60.9]    // nord-est
    );

    /* ----------------------------------------------------------
       2. Création de la carte + blocages de déplacement
    ----------------------------------------------------------- */
    const map = L.map('map', {
      center: [16.265, -61.551],
      zoom: 10,
      maxBounds: guadeloupeBounds,
      maxBoundsViscosity: 1.0
    });

    /* ----------------------------------------------------------
       3. Tuiles (fonds de carte)
    ----------------------------------------------------------- */
    const satellite = L.tileLayer(
      'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
      { attribution: 'Tiles © Esri — Source: Esri, USDA, USGS, GeoEye, etc.' }
    );
    
    const osm = L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution: '© OpenStreetMap contributors' }
    );

    const relief = L.tileLayer(
      'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
      { attribution: '© OpenTopoMap (CC-BY-SA)' }
    );

    // Couche par défaut
    satellite.addTo(map);

    /* ----------------------------------------------------------
       4. Contrôle permettant de changer de fond de carte
    ----------------------------------------------------------- */
    const baseLayers = {
      "Satellite": satellite,
      "Classique (OSM)": osm,
      "Relief": relief
    };

    L.control.layers(baseLayers, null, {
      position: 'topleft',
      collapsed: false
    }).addTo(map);

    /* ----------------------------------------------------------
       5. Fonctions utilitaires pour couleurs + étoiles
    ----------------------------------------------------------- */
    function getColor(rating) {
      switch (rating) {
        case 5: return "#1a9850";
        case 4: return "#66bd63";
        case 3: return "#fee08b";
        case 2: return "#f46d43";
        case 1: return "#d73027";
        default: return "#888";
      }
    }

    function getStars(rating) {
      return "★".repeat(rating) + "☆".repeat(5 - rating);
    }

    /* ----------------------------------------------------------
       6. Spots (à adapter avec tes vrais lieux + photos)
    ----------------------------------------------------------- */
    const spots = [
      {
        name: "Malendure, Bouillante",
        coords: [16.1726, -61.7791],       // plage de Malendure :contentReference[oaicite:0]{index=0}
        desc: "Lieu de rêve pour croiser des tortues. Il faut rejoindre la petite plage au nord de la plage principale de Malendure pour maximiser ses chances d’en voir en milieu sauvage. On peut également observer des torpilles et des barracudas. La visibilité est globalement bonne.",
        rating: 4,
        images: ["images/malendure1.JPG","images/malendure2.JPG","images/malendure3.JPG","images/malendure4.jpg","images/malendure5.jpg","images/malendure6.jpg","images/malendure7.jpg","images/malendure8.jpg"]
      },
      {
        name: "Bosco, Deshaies",
        coords: [16.2864, -61.8027],    // plage Bosco / Paul Thomas :contentReference[oaicite:1]{index=1}
        desc: "Lieu calme et un peu secret. On y accède en contournant un portail présenté comme une résidence privée. Beaucoup de crabes touloulous, une très bonne visibilité et une grande richesse aquatique de part et d’autre de la plage.",
        rating: 5,
        images: ["images/bosco1.jpg","images/bosco2.jpg","images/bosco3.jpg","images/bosco4.jpg","images/bosco5.jpg","images/bosco6.jpg","images/bosco7.jpg","images/bosco8.jpg","images/bosco9.jpg"]
      },
      {
        name: "Anse de Deshaies, Deshaies",
        coords: [16.3075, -61.7966],      // zone Deshaies littoral :contentReference[oaicite:2]{index=2}
        desc: "Beaucoup de bateaux et un peu de turbidité, mais présence de poissons-globes et de tortues. Spot protégé des vagues et plutôt calme. Coin agréable avec en bonus un excellent restaurant, “L’Amer”, tout proche.",
        rating: 2,
        images: []
      },
      {
        name: "Ravine Thomas, Bouillante",
        coords: [16.1095, -61.7747],      // commune Bouillante :contentReference[oaicite:3]{index=3}
        desc: "Biodiversité de rêve entre nudibranches et serpentines. Site riche en vie et en couleurs, avec de beaux coquillages et une grande diversité d’espèces tout au long de l’exploration. Proximité de bassins d’eaux thermales.",
        rating: 4,
        images: ["images/ravine_thomas1.jpg","images/ravine_thomas2.jpg","images/ravine_thomas3.jpg","images/ravine_thomas4.jpg","images/ravine_thomas5.jpg","images/ravine_thomas6.JPG","images/ravine_thomas7.jpg","images/ravine_thomas8.jpg","images/ravine_thomas9.jpg","images/ravine_thomas10.jpg"]
      },
      {
        name: "Anse à la Barque, Bouillante",
        coords: [16.0893, -61.7688],      // estimation proche Bouillante
        desc: "Lieu protégé des vagues, calme et avec peu de bateaux. Bon nombre d’espèces, notamment plusieurs pieuvres. Environnement de roches aménagées par l’humain, avec présence de mangroves puis de falaises au bout de l’anse.",
        rating: 3,
        images: ["images/anse_a_la_barque1.JPG","images/anse_a_la_barque2.jpg","images/anse_a_la_barque3.jpg","images/anse_a_la_barque4.jpg","images/anse_a_la_barque5.jpg","images/anse_a_la_barque6.jpg"]
      },
      {
        name: "Petite Terre, Terre-de-Bas",
        coords: [16.1747, -61.1092],      // estimation Petite-Terre
        desc: "Véritable nurserie de requins-citrons et de tortues. Le site est connu pour les requins-citrons juvéniles, les raies pastenagues et, avec un peu de chance, les requins dormeurs et les raies aigles. C’est une réserve naturelle avec beaucoup de règles en vigueur. Forte présence d’iguanes à terre et coraux plutôt abîmés dans la zone fréquentée. La zone accessible au public se situe entre les deux îles, le reste est interdit.",
        rating: 5,
        images: ["images/petite_terre1.jpg","images/petite_terre2.jpg","images/petite_terre3.jpg","images/petite_terre4.jpg","images/petite_terre5.jpg","images/petite_terre6.jpg","images/petite_terre7.jpg","images/petite_terre8.jpg","images/petite_terre9.jpg"]
      },
      {
        name: "Trou Man Louis, Anse-Bertrand",
        coords: [16.4861, -61.4972],      // estimation Port-Louis côte Est
        desc: "Endroit paradisiaque, mais il faut faire attention : en cas de vagues, le snorkeling devient très difficile. Eau transparente et chaude, avec de nombreux poissons colorés à observer.",
        rating: 3,
        images: ["images/trou_man_louis1.JPG","images/trou_man_louis2.jpg"]
      },
      {
        name: "Îlets du Gosier, Le Gosier",
        coords: [16.2000, -61.4921],      // estimation Le Gosier
        desc: "Site très dégradé avec un fort impact anthropique. La balade autour de l’îlet est sympa, mais ce n’est pas un spot intéressant pour le snorkeling.",
        rating: 1,
        images: []
      },
      {
        name: "Malendure, Bouillante",
        coords: [16.1691, -61.7776],       // identique à Malendure plage
        desc: "Au pied du club de plongée “Les Heures Saines” se trouve le dortoir des tortues vertes et imbriquées locales. Sortie conseillée de nuit. Grande richesse d’espèces et de coraux entre les gros blocs rocheux.",
        rating: 4,
        images: ["images/malendure_night1.jpg","images/malendure_night2.jpg","images/malendure_night3.jpg","images/malendure_night4.jpg","images/malendure_night5.jpg","images/malendure_night6.JPG","images/malendure_night7.jpg","images/malendure_night8.jpg","images/malendure_night9.jpg","images/malendure_night10.jpg","images/malendure_night11.jpg","images/malendure_night12.jpg","images/malendure_night13.jpg"]
      },
      {
        name: "Îlets Pigeon (Réserve Cousteau), Bouillante",
        coords: [16.1674, -61.7895],      // coord. Réserve Cousteau :contentReference[oaicite:4]{index=4}
        desc: "Accès en kayak, eau transparente et grande zone d’exploration. Présence de nombreux poissons balistes (non agressifs). Potentiel d’exploration encore important.",
        rating: 5,
        images: ["images/reserve_cousteau1.jpg","images/reserve_cousteau2.JPG","images/reserve_cousteau3.jpg"]
      },
      {
        name: "Plage de Leroux, Deshaies",
        coords: [16.2769, -61.8050],      // proche plage Bosco / Leroux :contentReference[oaicite:5]{index=5}
        desc: "Un des meilleurs endroits en termes d’équilibre entre calme, beauté et qualité de snorkeling. L’épi central est très riche en biodiversité, même si la zone reste assez petite. Le reste est un peu plus dégradé, mais une après-midi sur cette plage est fortement conseillée.",
        rating: 3,
        images: ["images/plage_leroux1.jppg.JPG","images/plage_leroux2.jpg","images/plage_leroux3.jpg","images/plage_leroux4.jpg","images/plage_leroux5.jpg","images/plage_leroux6.jpg","images/plage_leroux7.JPG"]
      },
      {
        name: "Plage du Souffleur, Port-Louis",
        coords: [16.4258, -61.5353],      // estimation Port-Louis
        desc: "Fond plutôt dégradé et pollué par des résidus de filets de pêche et quelques plastiques sur le sable. L’eau reste belle avec quelques poissons, mais il y a relativement peu à voir comparé à d’autres sites. Plage très fréquentée et très jolie.",
        rating: 2,
        images: ["images/plage_du_souffleur1.jpg","images/plage_du_souffleur2.jpg"]
      },
      {
        name: "Plage d’Antigues, Port-Louis",
        coords: [16.4369, -61.5386],      // estimation côte Est
        desc: "Semblable à la très connue plage du Souffleur, mais plus excentrée, donc plus calme et moins fréquentée. Plus de présence d’herbiers marins, avec possibilité d’observer des raies et des requins juvéniles.",
        rating: 3,
        images: ["images/plage_antigues1.jpg","images/plage_antigues2.jpg","images/plage_antigues3.jpg","images/plage_antigues4.jpg"]
      },
      {
        name: "Anse des Rochers, Saint-François",
        coords: [16.2417, -61.3064],      // estimation St-François côté Est
        desc: "Site accessible via une résidence / centre de vacances. Très belle plage, sécurisée et protégée des vagues. Principalement des espèces juvéniles qui se cachent dans les herbiers et les petits amas de roches.",
        rating: 2,
        images: []
      },
      {
        name: "Les Trois Pointes, Vieux-Fort",
        coords: [15.9556, -61.7105],      // estimation Vieux-Fort sud Basse-Terre
        desc: "Riche en couleurs et en biodiversité, avec des bleus marins magnifiques et de nombreuses espèces présentes. Attention aux possibles mouvements d’eau. Lieu reculé, très agréable à explorer en immersion complète.",
        rating: 4,
        images: ["images/les_trois_pointes1.JPG","images/les_trois_pointes2.jpg","images/les_trois_pointes3.jpg"]
      },
      {
        name: "Morphy, Pointe-Noire",
        coords: [16.2527, -61.8043],      
        desc: "Lieu légèrement exposé à la houle de la mer des Caraïbes. Excellent spot de plongée et très bon endroit pour le snorkeling. Les reliefs sous-marins y sont nombreux, avec une belle diversité de couleurs et d’espèces. Plage de galets, pente douce qui descend régulièrement jusqu’à environ 30 mètres de profondeur.",
        rating: 4,
        images: ["images/morphy1.JPG","images/morphy2.JPG","images/morphy3.JPG","images/morphy4.JPG","images/morphy5.JPG","images/morphy6.JPG"]
      },
      {
        name: "Plage de la Résidence Départementale, Le Gosier",
        coords: [16.2147, -61.5160],      
        desc: "Petite plage située au pied du fort. L’endroit est charmant et un peu escarpé, mais la visibilité est très mauvaise : les vagues remuent constamment le sable, ce qui empêche toute observation sous-marine.",
        rating: 1,
        images: []
      },
      {
        name: "Plage de Bas-Du-Fort, Le Gosier",
        coords: [16.2138, -61.5240],      
        desc: "Très belle plage, très touristique et plutôt petite. L’eau y est protégée, mais la visibilité reste faible et la biodiversité observée limitée. Spot agréable pour se baigner, mais peu adapté au snorkeling.",
        rating: 1,
        images: []
      },
      {
        name: "Plage de Petit-Havre, Sainte-Anne",
        coords: [16.2090, -61.4270],      
        desc: "Petit coin sauvage apprécié pour les barbecues et un peu de surf. Quelques zones plus reculées offrent une visibilité correcte et quelques poissons, mais cela reste un petit spot de snorkeling sans grande richesse.",
        rating: 2,
        images: []
      },
      {
        name: "Anse Sainte-Marguerite, Le Moule",
        coords: [16.3893, -61.4049],      
        desc: "Zone partiellement protégée des vagues, mais qui devient vite impraticable lorsque la houle est forte (ce qui est fréquent sur cette côte). Plage assez rocheuse, pas très propre et peu adaptée au snorkeling. C’est surtout un très bel endroit pour se promener plutôt que pour observer les fonds marins.",
        rating: 1,
        images: []
      }
    ];

    /* ----------------------------------------------------------
       7. Marqueurs colorés + popup avec photo
    ----------------------------------------------------------- */

    // Index courant de l'image pour chaque spot
    const currentImageIndex = spots.map(() => 0);

    // Fonction appelée par les boutons ‹ et ›
    function changeImage(spotIndex, direction) {
      const imgs = spots[spotIndex].images;
      if (!imgs || imgs.length === 0) return;

      const n = imgs.length;
      // on avance ou recule dans le tableau, en bouclant
      currentImageIndex[spotIndex] =
        (currentImageIndex[spotIndex] + direction + n) % n;

      const imgEl = document.getElementById(`slider-img-${spotIndex}`);
      const counterEl = document.getElementById(`slider-counter-${spotIndex}`);

      if (imgEl) {
        imgEl.src = imgs[currentImageIndex[spotIndex]];
      }
      if (counterEl) {
        counterEl.textContent = `${currentImageIndex[spotIndex] + 1} / ${n}`;
      }
    }

    
    spots.forEach((spot, index) => {

      let imagesHtml = "";
      if (spot.images && spot.images.length > 0) {
        imagesHtml = `
          <div class="slider">
            <button type="button"
                    class="slider-btn"
                    onclick="changeImage(${index}, -1)">‹</button>
            <img id="slider-img-${index}"
                  src="${spot.images[0]}"
                  alt="${spot.name}"
                  style="max-width:180px; border-radius:8px; display:block;">
            <button type="button"
                    class="slider-btn"
                    onclick="changeImage(${index}, 1)">›</button>
          </div>
          <div class="slider-counter"
                id="slider-counter-${index}">
                1 / ${spot.images.length}
          </div>
        `;
      }

      const popupContent = `
        <b>${spot.name}</b><br>
        ${spot.desc}<br>
        Note : ${getStars(spot.rating)}<br><br>
        ${imagesHtml}
      `;

      const icon = L.divIcon({
        className: `custom-marker rating-${spot.rating}`,
        iconSize: [24, 24],
        iconAnchor: [12, 12]
      });

      L.marker(spot.coords, { icon })
        .addTo(map)
        .bindPopup(popupContent);
    });

    /* ----------------------------------------------------------
       8. Légende étoiles + couleurs
    ----------------------------------------------------------- */
    const legend = L.control({ position: 'topright' });

    legend.onAdd = function () {
      const div = L.DomUtil.create('div', 'legend');
      const ratings = [5, 4, 3, 2, 1];

      div.innerHTML += "<b>Qualité du spot</b><br>";

      ratings.forEach(r => {
        div.innerHTML += `
          <i style="background:${getColor(r)};"></i>
          ${getStars(r)}<br>
        `;
      });

      return div;
    };

    legend.addTo(map);
  </script>
</body>
</html>
